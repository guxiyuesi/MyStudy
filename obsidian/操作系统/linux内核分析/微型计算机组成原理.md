---
tags: 操作系统 计组
---

## 现代PC机组成原理
![现代PC机芯片集框图](https://gitee.com/four_four/picgo/raw/master/img/20211121000856.png) 

+ 北桥: 用于与CPU, 内存, AGP视频接口, 这些接口有**很高的传输速率**, 同时北桥还有存储器控制作用, 因此也称为MCH(Memory Controller Hub)
+ 南桥: 用来管理低, 中速的组件, 如USB接口等, 因此又名ICH(I/O Controller Hub)


## I/O 端口和寻址

^15a56c

CPU访问I/O 接口控制器或控制卡上的数据和状态信息时, 首先要指定它们的地址, 这种地址又称为**I/O端口地址**或**端口** 
I/O控制器包含:
1. 数据的数据端口
2. 输出命令的命令端口
3. 访问控制器执行状态的状态接口

linux下, 可以通过查看 `/proc/ioports` 文件查看相关控制器或设置使用的I/O地址范围
### 端口统一编址
端口地址归入存储器寻址地址空间范围, CPU访问端口的方式与访问内存相同
### 端口独立编址
把I/O控制器和控制卡的寻址空间单独作为一个独立的地址空间对待, 称为I/O地址空间, 每个端口对应一个I/O地址, 使用专门的I/O指令


## 接口访问
### 程序循环查询方式
CPU在程序中循环查询指定设备控制器中的状态来判断是否与设备进行数据交换
### 中端处理控制程序
只有当I/O设备通过终端向CPU提出处理请求时, CPU才会暂时中断当前执行的程序转而执行相应的I/O中断处理服务过程.
需要使用**中断向量表** 来寻址相应的中断处理服务过程的入口地址
### DMA传输
I/O与系统内存之间进行批量数据传送, 无需CPU介入

## 存储器
### 主存储器
![PC/AT机内存使用区域图](https://gitee.com/four_four/picgo/raw/master/img/20211121003450.png) 
0xA0000-0xFFFFF(640K-1M 共384K): 用于I/O设备BIOS
0xFFFE000-0xFFFFFFF(最后64K): 系统BIOS
0x0-0x0FFFF(前64K): 内核代码和数据

### CMOS存储器
存储计算机的实时时钟信息和系统硬件配置信息.
**CMOS内存的地址空间在基本内存地址空间之外, 需要使用I/O指令** 

### 中断控制器
IBM PC/AT 80x86 兼容微机使用两片级联的8259A可编程中断控制芯片来组成中断控制器.

可以实现I/O 设备的中断控制数据读取方式, 以及为15个设备提供独立的中断控制功能.

![](https://gitee.com/four_four/picgo/raw/master/img/20211121205447.png)

设备初始化时, ROM BIOS会对两片8259A芯片初始化, 并将15级中断优先级分配给不同的I/O设备或控制器使用, 同时在0x000-0xFFF处区域内建立一个中断向量表.

![](https://gitee.com/four_four/picgo/raw/master/img/20211121205653.png)

Linux并不直接使用这个中断向量表, 它会重新设置中断请求号与中断向量表之间的对应关系

### DMA控制器
主要功能: 通过让**外部设备直接与内存传输数据**来增强系统的性能

### 定时/计数器
Intel 8253/8254 是一个可编程定时/计数器芯片, 用于处理计算机中的精确时间延迟. 可以提供3个独立的16位计数器通道, 可以工作在不同的工作方式下, 且可以使用软件设置.

延时结束后, 8253/8254 会向CPU发送一个中断信号.

PC/AT及其兼容微机使用的是8254芯片, 三个通道分别被用于:

1. 日式钟计时中断信号
2. 动态内存DRAM刷新定时电路
3. 主机扬声器音调合成

Linux 0.11 对通道0重新设置为方式3, 每隔10ms发送一个信号以产生中断请求信号(IRQ0), 用于 **定时切换当前执行的任务**和**统计每个任务使用的系统资源量** 


### 键盘控制器

键盘上有一个称为**键盘编码器**的处理器, 专门收集按键按下和松开的状态信息(即扫描码), 并发送到主机主板上**键盘控制器**中.

按下 -> 接通扫描码(Make code)
松开 -> 断开扫描码(Break code)

键盘控制器对键盘扫描码进行解吗, 然后将解码后的数据发送到操作系统的键盘数据队列中. 每个键盘的接通码和断开码都是不同的, 因此可以组成一个键盘的扫描码集合, 根据扫描码就可以确定用户在使用的键. 

键盘控制器接收键盘发来的11位串行格式化数据

| 位数 | 说明         |
| ---- | ------------ |
| 1    | 起始位       |
| 2-9  | 键盘扫描码   |
| 10   | 奇校验校验位 |
| 11   | 停止位       |

断开码 = 接通码 + 0x80

扩展扫描码: 2-4字节, 第一个字节一定是0xE0

![](https://gitee.com/four_four/picgo/raw/master/img/20211121221714.png)

### 串行控制卡






